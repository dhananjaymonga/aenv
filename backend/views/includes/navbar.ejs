<nav class="bg-white shadow-md sticky top-0 z-50 transition-all duration-300">
    <div class="container mx-auto px-4 py-4">
        <div class="flex justify-between items-center">
            
            <!-- Left Side: Logo -->
            <a href="/listings" class="text-red-500 text-2xl font-bold flex items-center group transition-all duration-300 hover:scale-105">
                <i class="fa-solid fa-house-chimney mr-2 group-hover:rotate-12 transition-transform duration-300"></i> 
                <span class="bg-gradient-to-r from-red-500 to-red-600 bg-clip-text text-transparent">Nestaway</span>
            </a>

            <!-- Mobile Menu Button -->
            <button id="menu-toggle" class="md:hidden text-gray-700 focus:outline-none focus:ring-2 focus:ring-red-500 rounded-lg p-2 transition-all duration-300 hover:bg-gray-100 active:scale-95">
                <i id="menu-icon" class="fa-solid fa-bars text-2xl transition-transform duration-300"></i>
            </button>

            <!-- Center Menu (Hidden on Mobile) -->
            <div class="hidden md:flex space-x-6">
                <a href="/listings" class="text-gray-700 font-medium hover:text-red-500 transition-all duration-300 relative group py-2">
                    Explore
                    <span class="absolute bottom-0 left-0 w-0 h-0.5 bg-red-500 group-hover:w-full transition-all duration-300"></span>
                </a>
            </div>
            
            <!-- Right Side: Authentication -->
            <div class="hidden md:flex space-x-4 items-center">
                <a href="/listings/new" class="text-gray-700 font-medium hover:text-red-500 transition-all duration-300 relative group py-2">
                    Create Listing
                    <span class="absolute bottom-0 left-0 w-0 h-0.5 bg-red-500 group-hover:w-full transition-all duration-300"></span>
                </a>
                <% if (!currentUser) { %>
                    <a href="/login" class="text-gray-700 font-medium hover:text-red-500 transition-all duration-300 relative group py-2">
                        Log in
                        <span class="absolute bottom-0 left-0 w-0 h-0.5 bg-red-500 group-hover:w-full transition-all duration-300"></span>
                    </a>
                    <a href="/signup" class="bg-red-500 text-white px-6 py-2.5 rounded-lg hover:bg-red-600 transition-all duration-300 transform hover:scale-105 hover:shadow-lg active:scale-95">
                        Sign up
                    </a>
                <% } else { %>
                    <span class="text-gray-700 font-medium px-4 py-2 bg-gray-100 rounded-lg animate-fade-in">
                        Welcome, <span class="text-red-500 font-semibold"><%= currentUser.username %></span>!
                    </span>
                    <a href="/logout" class="bg-gray-700 text-white px-6 py-2.5 rounded-lg hover:bg-gray-800 transition-all duration-300 transform hover:scale-105 hover:shadow-lg active:scale-95">
                        Log out
                    </a>
                <% } %>
            </div>
        </div>
    </div>

    <!-- Mobile Menu with Slide Animation -->
    <div id="mobile-menu" class="md:hidden overflow-hidden transition-all duration-500 ease-in-out max-h-0 opacity-0">
        <div class="flex flex-col space-y-3 bg-white shadow-inner p-6 border-t border-gray-100">
            <a href="/listings" class="text-gray-700 font-medium hover:text-red-500 hover:bg-red-50 transition-all duration-300 py-3 px-4 rounded-lg transform hover:translate-x-2">
                <i class="fa-solid fa-compass mr-2"></i> Explore
            </a>
            <a href="/listings/new" class="text-gray-700 font-medium hover:text-red-500 hover:bg-red-50 transition-all duration-300 py-3 px-4 rounded-lg transform hover:translate-x-2">
                <i class="fa-solid fa-plus-circle mr-2"></i> Create Listing
            </a>
            <% if (!currentUser) { %>
                <a href="/login" class="text-gray-700 font-medium hover:text-red-500 hover:bg-red-50 transition-all duration-300 py-3 px-4 rounded-lg transform hover:translate-x-2">
                    <i class="fa-solid fa-right-to-bracket mr-2"></i> Log in
                </a>
                <a href="/signup" class="bg-red-500 text-white px-6 py-3 rounded-lg hover:bg-red-600 transition-all duration-300 transform hover:scale-105 hover:shadow-lg active:scale-95 text-center">
                    <i class="fa-solid fa-user-plus mr-2"></i> Sign up
                </a>
            <% } else { %>
                <div class="text-gray-700 font-medium px-4 py-3 bg-gray-100 rounded-lg">
                    Welcome, <span class="text-red-500 font-semibold"><%= currentUser.username %></span>!
                </div>
                <a href="/logout" class="bg-gray-700 text-white px-6 py-3 rounded-lg hover:bg-gray-800 transition-all duration-300 transform hover:scale-105 hover:shadow-lg active:scale-95 text-center">
                    <i class="fa-solid fa-right-from-bracket mr-2"></i> Log out
                </a>
            <% } %>
        </div>
    </div>
</nav>

<!-- Enhanced JavaScript for Menu Toggle with Animation -->
<script>
    const menuToggle = document.getElementById("menu-toggle");
    const mobileMenu = document.getElementById("mobile-menu");
    const menuIcon = document.getElementById("menu-icon");
    
    menuToggle.addEventListener("click", function () {
        const isOpen = mobileMenu.classList.contains("max-h-0");
        
        if (isOpen) {
            // Open menu
            mobileMenu.classList.remove("max-h-0", "opacity-0");
            mobileMenu.classList.add("max-h-96", "opacity-100");
            menuIcon.classList.remove("fa-bars");
            menuIcon.classList.add("fa-times", "rotate-90");
        } else {
            // Close menu
            mobileMenu.classList.remove("max-h-96", "opacity-100");
            mobileMenu.classList.add("max-h-0", "opacity-0");
            menuIcon.classList.remove("fa-times", "rotate-90");
            menuIcon.classList.add("fa-bars");
        }
    });

    // Close mobile menu when clicking outside
    document.addEventListener("click", function(event) {
        const isClickInside = menuToggle.contains(event.target) || mobileMenu.contains(event.target);
        
        if (!isClickInside && !mobileMenu.classList.contains("max-h-0")) {
            mobileMenu.classList.remove("max-h-96", "opacity-100");
            mobileMenu.classList.add("max-h-0", "opacity-0");
            menuIcon.classList.remove("fa-times", "rotate-90");
            menuIcon.classList.add("fa-bars");
        }
    });

    // Close menu when resizing to desktop view
    window.addEventListener("resize", function() {
        if (window.innerWidth >= 768 && !mobileMenu.classList.contains("max-h-0")) {
            mobileMenu.classList.remove("max-h-96", "opacity-100");
            mobileMenu.classList.add("max-h-0", "opacity-0");
            menuIcon.classList.remove("fa-times", "rotate-90");
            menuIcon.classList.add("fa-bars");
        }
    });
</script>

<style>
    @keyframes fade-in {
        from {
            opacity: 0;
            transform: translateY(-10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    .animate-fade-in {
        animation: fade-in 0.5s ease-out;
    }
</style>