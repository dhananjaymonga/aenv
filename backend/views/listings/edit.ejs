<%layout("/layouts/boilerplate")%>

<body>

    <div class=" w-full max-w-3xl mx-auto bg-white shadow-lg rounded-2xl p-6 mt-10">
        <!-- Title Section -->
        <h2 class="text-3xl font-bold text-gray-900 text-center">Edit Your Listing</h2>
        <p class="text-gray-500 text-center mt-2">Update the details of your place</p>
    
        <form action="/listings/<%= listing._id %>?_method=PUT" method="POST" class="mt-6 space-y-5 needs-validation" novalidate> 
            <div>
                <label for="title" class="block text-gray-700 font-medium">Title</label>
                <input type="text" id="title" name="listing[title]" required value="<%= listing.title %>"
                    class="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500"
                    aria-describedby="titleHelp" 
                    aria-invalid="true" 
                    aria-required="true">
                <div id="titleHelp" class="text-red-500 text-sm hidden">Title is required.</div>
            </div>
    
            <div>
                <label for="description" class="block text-gray-700 font-medium">Description</label>
                <textarea id="description" name="listing[description]" required rows="3"
                    class="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500"
                    aria-describedby="descriptionHelp"
                    aria-invalid="true"
                    aria-required="true"><%= listing.description %></textarea>
                <div id="descriptionHelp" class="text-red-500 text-sm hidden">Description is required.</div>
            </div>
    
            <div>
                <label for="imageUrl" class="block text-gray-700 font-medium">Image URL</label>
                <input type="url" id="imageUrl" name="listing[image][url]" required value="<%= listing.image.url %>"
                    class="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500"
                    aria-describedby="imageUrlHelp"
                    aria-invalid="true"
                    aria-required="true">
                <div id="imageUrlHelp" class="text-red-500 text-sm hidden">A valid URL is required for the image.</div>
            </div>
    
            <div>
                <label for="price" class="block text-gray-700 font-medium">Price per Night (in ₹)</label>
                <input type="number" id="price" name="listing[price]" required min="1" value="<%= listing.price %>"
                    class="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500"
                    aria-describedby="priceHelp"
                    aria-invalid="true"
                    aria-required="true">
                <div id="priceHelp" class="text-red-500 text-sm hidden">Price must be at least ₹1.</div>
            </div>
    
            <div>
                <label for="country" class="block text-gray-700 font-medium">Country</label>
                <input type="text" id="country" name="listing[country]" required value="<%= listing.country %>"
                    class="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500"
                    aria-describedby="countryHelp"
                    aria-invalid="true"
                    aria-required="true">
                <div id="countryHelp" class="text-red-500 text-sm hidden">Country is required.</div>
            </div>
    
            <div>
                <label for="location" class="block text-gray-700 font-medium">Location</label>
                <input type="text" id="location" name="listing[location]" required value="<%= listing.location %>"
                    class="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500"
                    aria-describedby="locationHelp"
                    aria-invalid="true"
                    aria-required="true">
                <div id="locationHelp" class="text-red-500 text-sm hidden">Location is required.</div>
            </div>
    
            <div>
                <label class="block text-gray-700 font-medium mb-2">Amenities</label>
                <div class="flex flex-wrap gap-3">
                    <% let amenitiesList = ["WiFi", "Kitchen", "Parking", "Pool"]; %>
                    <% amenitiesList.forEach(amenity => { %>
                        <label class="flex items-center">
                            <input type="checkbox" name="listing[amenities]" value="<%= amenity %>" 
                                <%= listing.amenities.includes(amenity) ? "checked" : "" %> class="mr-2">
                            <%= amenity %>
                        </label>
                    <% }) %>
                </div>
            </div>
    
            <!-- Buttons -->
            <div class="flex justify-between items-center">
                <!-- Update Button -->
                <button type="submit"
                    class="bg-red-500 text-white py-3 px-6 rounded-lg text-lg font-semibold hover:bg-red-600 transition">
                    Update Listing
                </button>
    
                <!-- Delete Listing -->
                <form action="/listings/<%= listing._id %>?_method=DELETE" method="POST">
                    <button type="submit"
                        class="bg-gray-300 text-gray-800 py-3 px-6 rounded-lg text-lg font-semibold hover:bg-gray-400 transition">
                        Delete Listing
                    </button>
                </form>
            </div>
        </form>
    </div>
    
    <script>
        // Basic form validation feedback
        document.querySelector('form').addEventListener('submit', function(event) {
            let formIsValid = true;
            const inputs = document.querySelectorAll('input[required], textarea[required]');
            inputs.forEach(input => {
                const helpText = document.getElementById(input.id + 'Help');
                if (!input.validity.valid) {
                    formIsValid = false;
                    helpText.classList.remove('hidden');
                    input.classList.add('border-red-500');
                } else {
                    helpText.classList.add('hidden');
                    input.classList.remove('border-red-500');
                }
            });

            if (!formIsValid) {
                event.preventDefault();
            }
        });
    </script>
</body>
</html>
